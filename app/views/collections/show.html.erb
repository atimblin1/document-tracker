<div class="max-w-5xl mx-auto">
  <div class="mb-6">
    <%= link_to "← Back to Collections", collections_path, class: "text-blue-600 hover:text-blue-800 text-sm font-medium" %>
  </div>
  
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 md:p-6 mb-6">
    <div class="flex flex-col md:flex-row md:justify-between md:items-start gap-4">
      <div class="flex-1">
        <h1 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2"><%= @collection.name %></h1>
        
        <% if @collection.description.present? %>
          <p class="text-gray-700 mb-4"><%= @collection.description %></p>
        <% end %>
        
        <p class="text-sm text-gray-500">
          Created <%= @collection.created_at.strftime("%B %d, %Y") %>
        </p>
      </div>
      
      <% unless demo_mode? %>
        <div class="flex md:flex-col gap-2 w-full md:w-auto md:ml-6">
          <%= link_to "Edit", edit_collection_path(@collection), class: "flex-1 md:flex-none px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 transition text-center" %>
          <%= button_to "Delete", collection_path(@collection), method: :delete, data: { confirm: "Are you sure?" }, class: "flex-1 md:flex-none px-4 py-2 bg-red-600 text-white text-sm font-medium rounded-md hover:bg-red-700 transition" %>
        </div>
      <% end %>
    </div>
  </div>
  
  <!-- Add Document Form -->
  <% unless demo_mode? %>
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
      <h3 class="text-lg font-semibold text-gray-900 mb-4">Add Document to Collection</h3>
      
      <% if @available_documents.any? %>
        <%= form_with url: collection_collection_items_path(@collection), method: :post, class: "flex flex-col sm:flex-row gap-3" do |f| %>
          <%= f.select :document_id, options_for_select(@available_documents.map { |d| [d.title, d.id] }), { prompt: "Select a document" }, class: "flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" %>
          <%= f.submit "Add to Collection", class: "px-6 py-2 bg-blue-600 text-white font-medium rounded-md hover:bg-blue-700 transition cursor-pointer" %>
        <% end %>
      <% else %>
        <p class="text-sm text-gray-600">All available documents have been added to this collection.</p>
      <% end %>
    </div>
  <% end %>
  
  <!-- Documents in Collection -->
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
    <h3 class="text-lg font-semibold text-gray-900 mb-4">Documents (<%= @collection.collection_items.count %>)</h3>
    
    <% if @collection.collection_items.any? %>
      <div class="space-y-3">
        <% @collection.collection_items.each do |item| %>
          <div class="flex flex-col sm:flex-row sm:items-center gap-3 p-3 md:p-4 bg-gray-50 rounded-lg border border-gray-200">
            <% unless demo_mode? %>
              <div class="flex sm:flex-col gap-2 sm:gap-1 order-last sm:order-first">
                <%= button_to "↑", move_up_collection_collection_item_path(@collection, item), method: :patch, class: "flex-1 sm:flex-none px-3 sm:px-2 py-1 bg-gray-200 hover:bg-gray-300 rounded text-xs font-bold text-gray-700", disabled: item.position == 0 %>
                <%= button_to "↓", move_down_collection_collection_item_path(@collection, item), method: :patch, class: "flex-1 sm:flex-none px-3 sm:px-2 py-1 bg-gray-200 hover:bg-gray-300 rounded text-xs font-bold text-gray-700", disabled: item.position == @collection.collection_items.count - 1 %>
              </div>
            <% end %>
            
            <div class="flex-1 min-w-0">
              <%= link_to item.document.title, document_path(item.document), class: "font-medium text-gray-900 hover:text-blue-600 break-words" %>
              
              <div class="flex flex-wrap gap-2 mt-2">
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium <%= status_badge_class(item.document.status) %>">
                  <%= item.document.status.titleize %>
                </span>
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                  <%= item.document.doc_type.titleize %>
                </span>
              </div>
            </div>
            
            <% unless demo_mode? %>
              <%= button_to "Remove", collection_collection_item_path(@collection, item), method: :delete, data: { confirm: "Remove this document from the collection?" }, class: "w-full sm:w-auto px-3 py-2 text-sm bg-red-100 text-red-700 hover:bg-red-200 rounded font-medium" %>
            <% end %>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="text-center py-8">
        <p class="text-gray-600">No documents in this collection yet.</p>
      </div>
    <% end %>
  </div>
</div>
